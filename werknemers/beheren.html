<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Werknemers Beheren</title>
  <link rel="stylesheet" href="/Teck-personnal/css/style.css" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>

<body data-title="Werknemers beheren">

  <!-- HEADER WORDT HIER INGEZET -->
  <div id="header-placeholder"></div>

  <main class="content">
    <h1>Werknemers beheren</h1>
    <p>Voeg hier nieuwe werknemers toe en beheer bestaande.</p>

    <section class="employee-list">
      <h2>Huidige Werknemers</h2>
      <table>
        <thead>
          <tr>
            <th>Naam</th>
            <th>Functie</th>
            <th>Email</th>
            <th>Actie</th>
          </tr>
        </thead>
        <tbody id="werknemerTableBody"></tbody>
      </table>
    </section>

    <section class="add-employee" style="margin-top: 2rem;">
      <h3 id="werknemerFormTitel">Nieuwe werknemer toevoegen</h3>
      <form id="werknemerForm">
        <input type="text" id="werknemerNaam" placeholder="Naam" required />
        <input type="text" id="werknemerFunctie" placeholder="Functie" required />
        <input type="email" id="werknemerEmail" placeholder="Email" required />
        <button type="submit">Opslaan</button>
        <button type="button" id="annuleerWerknemerBtn" style="display:none;">Annuleren</button>
      </form>
    </section>
  </main>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBM03URLmymAoYM-RG9ke40YIrAvTrOuNY",
      authDomain: "teck-personnal.firebaseapp.com",
      projectId: "teck-personnal",
      storageBucket: "teck-personnal.appspot.com",
      messagingSenderId: "877076892450",
      appId: "1:877076892450:web:917be69a1428a8697f737b",
      measurementId: "G-88TT8R5S00"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const werknemerForm = document.getElementById('werknemerForm');
    const werknemerTbody = document.getElementById('werknemerTableBody');
    const werknemerFormTitel = document.getElementById('werknemerFormTitel');
    const annuleerBtn = document.getElementById('annuleerWerknemerBtn');

    let bewerkWerknemerId = null;

    function laadWerknemers() {
      db.collection('werknemers').orderBy('naam').onSnapshot(snapshot => {
        werknemerTbody.innerHTML = '';
        snapshot.forEach(doc => {
          const wn = doc.data();
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${wn.naam}</td>
            <td>${wn.functie}</td>
            <td>${wn.email}</td>
            <td>
              <button onclick="bewerkWerknemer('${doc.id}', '${wn.naam}', '${wn.functie}', '${wn.email}')">‚úèÔ∏è</button>
              <button onclick="verwijderWerknemer('${doc.id}')">üóëÔ∏è</button>
            </td>`;
          werknemerTbody.appendChild(tr);
        });
      });
    }

    laadWerknemers();

    werknemerForm.addEventListener('submit', (e) => {
      e.preventDefault();

      const naam = werknemerNaam.value.trim();
      const functie = werknemerFunctie.value.trim();
      const email = werknemerEmail.value.trim();

      if (bewerkWerknemerId) {
        db.collection('werknemers').doc(bewerkWerknemerId)
          .update({ naam, functie, email, updatedAt: firebase.firestore.FieldValue.serverTimestamp() })
          .then(resetWerknemerForm);
      } else {
        db.collection('werknemers').add({
          naam, functie, email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }).then(resetWerknemerForm);
      }
    });

    function verwijderWerknemer(id) {
      if (confirm('Weet je zeker dat je deze werknemer wilt verwijderen?')) {
        db.collection('werknemers').doc(id).delete();
      }
    }

    function bewerkWerknemer(id, naam, functie, email) {
      werknemerNaam.value = naam;
      werknemerFunctie.value = functie;
      werknemerEmail.value = email;
      bewerkWerknemerId = id;
      werknemerFormTitel.textContent = "Werknemer bewerken";
      annuleerBtn.style.display = "inline-block";
    }

    function resetWerknemerForm() {
      werknemerForm.reset();
      bewerkWerknemerId = null;
      werknemerFormTitel.textContent = "Nieuwe werknemer toevoegen";
      annuleerBtn.style.display = "none";
    }

    annuleerBtn.addEventListener('click', resetWerknemerForm);
  </script>
  <script src="/Teck-personnal/includes/header-script.js" defer></script>
</body>
</html>
